<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Kaichao Sun"><meta name=description content="kaichao's blog"><meta name=generator content="Hugo 0.62.2"><title>Substrate Module Struct</title><link rel="shortcut icon" href=https://kaichaosun.github.io/images/favicon.ico><link rel=stylesheet href=https://kaichaosun.github.io/css/style.css><link rel=stylesheet href=https://kaichaosun.github.io/css/highlight.css><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css><meta property="og:title" content="Substrate Module Struct"><meta property="og:description" content="The Module struct is the backbone of each Substrate runtime module. It wraps a set of useful functions and implementations which is either written by runtime developer or generated by the macros with Substrate.
This page will explore the various components of the Module struct to help gain a better understanding of how it all works together.
Components of the Module Struct Let's recall how we declare a raw Module struct within decl_module!"><meta property="og:type" content="article"><meta property="og:url" content="https://kaichaosun.github.io/post/substrate_module_struct/"><meta property="article:published_time" content="2019-07-30T00:00:00+00:00"><meta property="article:modified_time" content="2019-07-30T00:00:00+00:00"><meta itemprop=name content="Substrate Module Struct"><meta itemprop=description content="The Module struct is the backbone of each Substrate runtime module. It wraps a set of useful functions and implementations which is either written by runtime developer or generated by the macros with Substrate.
This page will explore the various components of the Module struct to help gain a better understanding of how it all works together.
Components of the Module Struct Let's recall how we declare a raw Module struct within decl_module!"><meta itemprop=datePublished content="2019-07-30T00:00:00+00:00"><meta itemprop=dateModified content="2019-07-30T00:00:00+00:00"><meta itemprop=wordCount content="552"><meta itemprop=keywords content="Blockchain,Substrate,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Substrate Module Struct"><meta name=twitter:description content="The Module struct is the backbone of each Substrate runtime module. It wraps a set of useful functions and implementations which is either written by runtime developer or generated by the macros with Substrate.
This page will explore the various components of the Module struct to help gain a better understanding of how it all works together.
Components of the Module Struct Let's recall how we declare a raw Module struct within decl_module!"><meta name=twitter:site content="@https://twitter.com/kaichaosun"></head><body><nav class=main-nav><a href=https://kaichaosun.github.io/><span class=arrow>←</span>Home</a>
<a href=/about/>About</a>
<a class=cta href=#email-subscribe>Subscribe</a></nav><section id=wrapper><article class=post><header><h1>Substrate Module Struct</h1><h2 class=subtitle></h2><h2 class=headline>July 30, 2019<br><a href=https://kaichaosun.github.io/tags/blockchain>Blockchain</a>
<a href=https://kaichaosun.github.io/tags/substrate>Substrate</a></h2></header><aside><nav id=TableOfContents><ul><li><a href=#components-of-the-module-struct>Components of the Module Struct</a></li><li><a href=#module-struct-implementations>Module Struct Implementations</a><ul><li><a href=#callable-functions>Callable Functions</a></li><li><a href=#runtime-storage>Runtime Storage</a></li><li><a href=#oninitialize--onfinalize>OnInitialize / OnFinalize</a></li><li><a href=#module-internal-functions>Module Internal Functions</a></li></ul></li><li><a href=#all-modules-tuple>All Modules Tuple</a></li><li><a href=#module-metadata>Module Metadata</a></li></ul></nav></aside><section id=post-body><p>The <code>Module</code> struct is the backbone of each Substrate runtime module. It wraps a set of useful functions and implementations which is either written by runtime developer or generated by the macros with Substrate.</p><p>This page will explore the various components of the <code>Module</code> struct to help gain a better understanding of how it all works together.</p><h2 id=components-of-the-module-struct>Components of the Module Struct</h2><p>Let's recall how we declare a raw <code>Module</code> struct within <a href=runtime/macros/decl_module.md><code>decl_module!</code> macro</a>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust>decl_module<span style=color:#f92672>!</span> {
    <span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Module</span><span style=color:#f92672>&lt;</span>T: <span style=color:#a6e22e>Trait</span><span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>for</span> <span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>Call</span> <span style=color:#66d9ef>where</span> origin: <span style=color:#a6e22e>T</span>::Origin {
        <span style=color:#75715e>// --snip--
</span><span style=color:#75715e></span>    }
}
</code></pre></div><p>The final generated definition of the <code>Module</code> struct in standard Rust looks like:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Module</span><span style=color:#f92672>&lt;</span>T: <span style=color:#a6e22e>Trait</span><span style=color:#f92672>&gt;</span>();
</code></pre></div><blockquote><p>If you are interested in the fully expanded code of your module, try using <a href=https://github.com/dtolnay/cargo-expand>cargo-expand</a> by following its instructions.</p></blockquote><p>On top of this struct, we implement a wealth of functions and traits for our module like:</p><ul><li><a href=#callable-functions>Callable Functions</a></li><li><a href=#runtime-storage>Runtime Storage</a></li><li><a href=#oninitialize-onfinalize>OnInitialize / OnFinalize</a></li><li>OffchainWorker</li><li>etc&mldr;</li></ul><p>In addition, the <code>Module</code> struct is used to implement all of the various <a href=#module-internal-functions>module internal functions</a> like <code>deposit_event</code>.</p><h2 id=module-struct-implementations>Module Struct Implementations</h2><h3 id=callable-functions>Callable Functions</h3><p>Runtime developers write callable functions that maintain the logic to manipulate the blockchain state. Here is an example that shows one callable function named <code>do_something</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#66d9ef>impl</span><span style=color:#f92672>&lt;</span>T: <span style=color:#a6e22e>Trait</span><span style=color:#f92672>&gt;</span> Module<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> {
    <span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>do_something</span>(origin: <span style=color:#a6e22e>T</span>::Origin, something: <span style=color:#66d9ef>u32</span>) -&gt; Result {
        <span style=color:#75715e>// --snip--
</span><span style=color:#75715e></span>    }
}
</code></pre></div><p>To make sure the functions can be called via an extrinsic, the <code>Module</code> struct also implements the <code>Callable</code> trait by connecting to the module's <code>Call</code> enum. All the dispatchable functions will be exposed through this <code>Call</code> enum, which you can learn more about <a href=runtime/types/call-enum.md>here</a>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#66d9ef>impl</span><span style=color:#f92672>&lt;</span>T: <span style=color:#a6e22e>Trait</span><span style=color:#f92672>&gt;</span> Callable <span style=color:#66d9ef>for</span> Module<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> {
    <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Call</span> <span style=color:#f92672>=</span> Call<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span>;
}
</code></pre></div><h3 id=runtime-storage>Runtime Storage</h3><p>The <code>Store</code> trait lists all of the runtime storage items exposed by the module. Each storage item is given a struct onto which all of its storage APIs are defined. You can learn more about individual storage item <a href=https://stackoverflow.com/questions/56599293/what-is-the-purpose-of-pub-in-decl-storage>here</a>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#66d9ef>impl</span><span style=color:#f92672>&lt;</span>T: <span style=color:#a6e22e>Trait</span><span style=color:#f92672>&gt;</span> Store <span style=color:#66d9ef>for</span> Module<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> {
    <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Something</span> <span style=color:#f92672>=</span> Something<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span>;
}
</code></pre></div><h3 id=oninitialize--onfinalize>OnInitialize / OnFinalize</h3><p><code>Module</code> struct implements the <code>OnInitialize</code> and <code>OnFinalize</code> traits that contain the functions that should be run at the beginning or end of block execution. You can learn more about those functions <a href=runtime/macros/decl_module.md#on_initialise-and-on_finalise>here</a>.</p><h3 id=module-internal-functions>Module Internal Functions</h3><p>The <code>Module</code> struct is also used to implement all the various module internal functions we define. This is why, when writing internal module functions, you write code like:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#66d9ef>impl</span><span style=color:#f92672>&lt;</span>T: <span style=color:#a6e22e>Trait</span><span style=color:#f92672>&gt;</span> Module<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> {
    <span style=color:#75715e>// --snip--
</span><span style=color:#75715e></span>}
</code></pre></div><p>We then gain access to these functions throughout our module with <code>Self::function_name()</code>.</p><p>For example, the default definition of <code>deposit_event</code> expands to look like:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#66d9ef>impl</span><span style=color:#f92672>&lt;</span>T: <span style=color:#a6e22e>Trait</span><span style=color:#f92672>&gt;</span> Module<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> {
    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>deposit_event</span>(event: <span style=color:#a6e22e>Event</span><span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span>) {
        <span style=color:#f92672>&lt;</span>system::Module<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span><span style=color:#f92672>&gt;</span>::deposit_event(<span style=color:#f92672>&lt;</span>T <span style=color:#66d9ef>as</span> Trait<span style=color:#f92672>&gt;</span>::from(event).into());
    }
}
</code></pre></div><p>and can be accessed with:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust>Self::deposit_event(...)
</code></pre></div><h2 id=all-modules-tuple>All Modules Tuple</h2><p>The <code>Module</code> struct is finally imported into your overall blockchain's runtime using the <code>construct_runtime!</code> macro. This macro includes your module along with all the other modules into a tuple called <code>AllModules</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>AllModules</span> <span style=color:#f92672>=</span> (
    timestamp::Module<span style=color:#f92672>&lt;</span>Runtime<span style=color:#f92672>&gt;</span>, 
    balances::Module<span style=color:#f92672>&lt;</span>Runtime<span style=color:#f92672>&gt;</span>, 
    template::Module<span style=color:#f92672>&lt;</span>Runtime<span style=color:#f92672>&gt;</span>, 
    <span style=color:#75715e>// --snip--
</span><span style=color:#75715e></span>);
</code></pre></div><p>This tuple is used by the runtime's <a href=https://substrate.dev/rustdocs/master/srml_executive/index.html>Executive module</a> which handles orchestration of executing these modules.</p><h2 id=module-metadata>Module Metadata</h2><p>Just like the <code>Module</code> struct, the metadata for your module contains all the various components of your module such as its storage items, callable functions, and events. When represented as JSON, the metadata for a module will look like:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;modules&#34;</span>:[
        {
            <span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;template&#34;</span>,
            <span style=color:#f92672>&#34;prefix&#34;</span>:<span style=color:#e6db74>&#34;TemplateModule&#34;</span>,
            <span style=color:#f92672>&#34;storage&#34;</span>:[<span style=color:#960050;background-color:#1e0010>.</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#960050;background-color:#1e0010>.</span>],
            <span style=color:#f92672>&#34;calls&#34;</span>:[<span style=color:#960050;background-color:#1e0010>.</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#960050;background-color:#1e0010>.</span>],
            <span style=color:#f92672>&#34;events&#34;</span>:[<span style=color:#960050;background-color:#1e0010>.</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#960050;background-color:#1e0010>.</span>]
        }
    ]
}
</code></pre></div></section></article><footer id=post-meta class=clearfix><a href=https://twitter.com/kaichaosun><img class=avatar src=https://kaichaosun.github.io/images/avatar.png><div><span class=dark>Kaichao Sun</span>
<span>Mark it down</span></div></a><section id=sharing><a class=twitter href="https://twitter.com/intent/tweet?text=https%3a%2f%2fkaichaosun.github.io%2fpost%2fsubstrate_module_struct%2f - Substrate%20Module%20Struct by @kaichaosun"><span class=icon-twitter>tweet</span></a>
<a class=facebook href=# onclick="window.open('https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),'facebook-share-dialog','width=626,height=436');return false;"><span class=icon-facebook-rect>Share</span></a></section></footer><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"whisperd"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a><ul id=post-list class="archive readmore"><iframe src=https://kaichao.substack.com/embed id=email-subscribe width=100% height=320 style="border:1px solid #eee;background:#fff;margin-top:60px" frameborder=0 scrolling=no></iframe><h3>Read more</h3><li><a href=/post/how_did_we_do_wrong/>关于新冠，我们做错了什么？<aside class=dates>Apr 14 2022</aside></a></li><li><a href=/post/understand_decentralization/>如何理解去中心<aside class=dates>Feb 23 2022</aside></a></li><li><a href=/post/build_team/>Build in Public：创业团队的重要性<aside class=dates>Feb 11 2022</aside></a></li><li><a href=/post/substrate_history/>Substrate 技术演进<aside class=dates>Jan 22 2022</aside></a></li><li><a href=/post/metaverse/>元宇宙会不会把我们从一条人变成一条狗？<aside class=dates>Jan 21 2022</aside></a></li><li><a href=/post/substrate_network_libp2p/>Substrate 如何使用 libp2p 进行点对点通信<aside class=dates>Feb 8 2021</aside></a></li><li><a href=/post/substrate_read_source_code/>阅读Substrate源码的方法<aside class=dates>Jan 6 2021</aside></a></li><li><a href=/post/learn_substrate/>如何学习Substrate<aside class=dates>Jul 20 2020</aside></a></li><li><a href=/post/substrate_launch_public_testnet/>Substrate 部署公开测试网络<aside class=dates>Jul 17 2020</aside></a></li><li><a href=/post/how_to_blockchain/>如何学习区块链技术<aside class=dates>Apr 30 2020</aside></a></li><li><a href=/post/kusama_governance/>Kusama系列：如何进行链上治理<aside class=dates>Apr 16 2020</aside></a></li><li><a href=/post/substrate_node_template_guide/>Substrate代码导读：node-template<aside class=dates>Apr 2 2020</aside></a></li><li><a href=/post/trie/>理解Substrate数据存储的底层实现Merkle Patricia Trie<aside class=dates>Mar 17 2020</aside></a></li><li><a href=/post/substrate_transaction_weight_and_fees/>Substrate 区块链应用的交易费用设计<aside class=dates>Feb 21 2020</aside></a></li><li><a href=/post/substrate_storage_data_type/>Substrate存储数据类型概览<aside class=dates>Jan 19 2020</aside></a></li><li><a href=/post/coin_flip_test_and_ui/>抛硬币游戏(二)：编写测试和UI<aside class=dates>Oct 3 2019</aside></a></li><li><a href=/post/substrate_metadata/>Substrate Runtime Metadata<aside class=dates>Sep 7 2019</aside></a></li><li><a href=/post/substrate_coin_flip/>Substrate应用 - 抛硬币游戏(一)<aside class=dates>Aug 5 2019</aside></a></li><li><a href=/post/substrate_blockchain_setup/>使用Substrate搭建你的第一条区块链<aside class=dates>May 28 2019</aside></a></li><li><a href=/post/why_oo_sucks/>Why OO Sucks<aside class=dates>Apr 25 2019</aside></a></li></ul><footer id=footer><div id=social><a class=symbol href=https://github.com/kaichaosun><i class="fa fa-github"></i></a><a class=symbol href=https://twitter.com/kaichaosun><i class="fa fa-twitter"></i></a></div><p class=small>© Copyright 2022 Kaichao Sun</p></footer></section><script src=//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js></script><script src=https://kaichaosun.github.io/js/main.js></script><script src=https://kaichaosun.github.io/js/highlight.js></script><script src=https://kaichaosun.github.io/js/fix-toc.js></script><script>hljs.initHighlightingOnLoad();</script><script data-ad-client=ca-pub-2513693433628672 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-128168145-1','auto');ga('send','pageview');}</script></body></html>