<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Kaichao Sun"><meta name=description content="kaichao's blog"><meta name=generator content="Hugo 0.62.2"><title>Understand Error Handling in Scala</title><link rel="shortcut icon" href=https://kaichaosun.github.io/images/favicon.ico><link rel=stylesheet href=https://kaichaosun.github.io/css/style.css><link rel=stylesheet href=https://kaichaosun.github.io/css/highlight.css><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css><meta property="og:title" content="Understand Error Handling in Scala"><meta property="og:description" content="What's Exception Exception are objects that defined in Java to represent error scenarios. Unhandled exceptions could terminate the program or show default message from http server.
Excpetion hirarchy Since Scala is designed to reuse Java standard or thirdparth library without much effort. It still worth to know the exception hirarachy originated in Java. It will help us deal with error scenarios.
 Throwable is the root of exception hirarchy. Exception subclasses represent errors that the program can recover from."><meta property="og:type" content="article"><meta property="og:url" content="https://kaichaosun.github.io/post/error_handling_in_scala/"><meta property="article:published_time" content="2019-01-17T00:00:00+00:00"><meta property="article:modified_time" content="2019-01-17T00:00:00+00:00"><meta itemprop=name content="Understand Error Handling in Scala"><meta itemprop=description content="What's Exception Exception are objects that defined in Java to represent error scenarios. Unhandled exceptions could terminate the program or show default message from http server.
Excpetion hirarchy Since Scala is designed to reuse Java standard or thirdparth library without much effort. It still worth to know the exception hirarachy originated in Java. It will help us deal with error scenarios.
 Throwable is the root of exception hirarchy. Exception subclasses represent errors that the program can recover from."><meta itemprop=datePublished content="2019-01-17T00:00:00+00:00"><meta itemprop=dateModified content="2019-01-17T00:00:00+00:00"><meta itemprop=wordCount content="1133"><meta itemprop=keywords content="FP,Scala,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Understand Error Handling in Scala"><meta name=twitter:description content="What's Exception Exception are objects that defined in Java to represent error scenarios. Unhandled exceptions could terminate the program or show default message from http server.
Excpetion hirarchy Since Scala is designed to reuse Java standard or thirdparth library without much effort. It still worth to know the exception hirarachy originated in Java. It will help us deal with error scenarios.
 Throwable is the root of exception hirarchy. Exception subclasses represent errors that the program can recover from."><meta name=twitter:site content="@https://twitter.com/kaichaosun"></head><body><nav class=main-nav><a href=https://kaichaosun.github.io/><span class=arrow>←</span>Home</a>
<a href=/about/>About</a>
<a class=cta href=#email-subscribe>Subscribe</a></nav><section id=wrapper><article class=post><header><h1>Understand Error Handling in Scala</h1><h2 class=subtitle></h2><h2 class=headline>January 17, 2019<br><a href=https://kaichaosun.github.io/tags/fp>FP</a>
<a href=https://kaichaosun.github.io/tags/scala>Scala</a></h2></header><aside><nav id=TableOfContents><ul><li><a href=#whats-exception>What's Exception</a><ul><li><a href=#excpetion-hirarchy>Excpetion hirarchy</a></li><li><a href=#checked-vs-unchecked-exceptions>Checked vs unchecked exceptions</a></li><li><a href=#exceptions-in-scala>Exceptions in Scala</a></li></ul></li><li><a href=#how-to-handle-exception>How to handle exception</a><ul><li><a href=#try-catch>try catch</a></li><li><a href=#option>Option</a></li><li><a href=#either>Either</a></li><li><a href=#try>Try</a></li><li><a href=#validated>Validated</a></li><li><a href=#monad-error>Monad Error</a></li><li><a href=#error-handling-with-io-monad>Error Handling with IO Monad</a></li></ul></li><li><a href=#summary>Summary</a></li><li><a href=#reference>Reference</a></li></ul></nav></aside><section id=post-body><h2 id=whats-exception>What's Exception</h2><p><code>Exception</code> are objects that defined in Java to represent error scenarios. Unhandled exceptions could terminate the program or show default message from http server.</p><h3 id=excpetion-hirarchy>Excpetion hirarchy</h3><p>Since Scala is designed to reuse Java standard or thirdparth library without much effort. It still worth to know the exception hirarachy originated in Java. It will help us deal with error scenarios.</p><p><img src=/static/error-handling/exception_hierarchy.png alt="Exception hierarachy"></p><ul><li><code>Throwable</code> is the root of exception hirarchy.</li><li><code>Exception</code> subclasses represent errors that the program can recover from.</li><li><code>Error</code> subclasses represent errors that a program generally shouldn't expect to catch and recover from, like OutOfMemoryError.</li><li><code>RuntimeException</code> is subclass of <code>Exception</code>, they represent programming errors that a program shouldn't generally expect to occur, but could recover from, like NullPointerException.</li><li>Subclasses of <code>Exception</code>, other than <code>RuntimeException</code>, represent errors that a program could generally meet, like network connection error, file read/write error.</li></ul><h3 id=checked-vs-unchecked-exceptions>Checked vs unchecked exceptions</h3><p><em>Checked excpetions</em> need to be declared in the method that throws it and must be handled by the callers, unless it will fail the compiler.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#a6e22e>FileInputStream</span><span style=color:#f92672>(</span>File file<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> FileNotFoundException
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
  FileInputStream fin <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> FileInputStream<span style=color:#f92672>(</span>file<span style=color:#f92672>)</span><span style=color:#f92672>;</span>
<span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>FileNotFoundException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
  e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>In Java we can also keep throwing the exception without handling it.</p><p>The <code>Error</code>s and <code>RuntimeException</code>s (and their subclasses) are called <em>unchecked exceptions</em>, means that:</p><ul><li>they can be thrown &ldquo;at any time&rdquo;</li><li>methods don't need to declare that they can throw such an exception</li><li>callers don't have to handle them explicitly.</li></ul><h3 id=exceptions-in-scala>Exceptions in Scala</h3><p>All exceptions in Scala are <em>unchecked</em> which means the Scala compiler doesn't require you to declare and handle the exception explicitly.</p><p>As a programming language aimed for functional programming, we should never throw exception in Scala code. It breaks the referential transparency. We have following two functions <code>foo1</code> and <code>foo2</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>def</span> foo1<span style=color:#f92672>(</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=</span> <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#66d9ef>false</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>else</span> <span style=color:#ae81ff>2</span>

<span style=color:#66d9ef>def</span> foo2<span style=color:#f92672>(</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>val</span> a <span style=color:#66d9ef>=</span> <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Exception</span>
  <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>false</span><span style=color:#f92672>)</span> a  <span style=color:#66d9ef>else</span> <span style=color:#ae81ff>2</span>
<span style=color:#f92672>}</span>

foo1<span style=color:#f92672>(</span><span style=color:#f92672>)</span> <span style=color:#75715e>// res0: Int = 2
</span><span style=color:#75715e></span>foo2<span style=color:#f92672>(</span><span style=color:#f92672>)</span> <span style=color:#75715e>// java.lang.Exception
</span></code></pre></div><p>Calling foo1 will terminate normally, calling foo2 will throw an exception.</p><p>We should always use a FP way to handle exception in Scala. I have listed a few options below.</p><h2 id=how-to-handle-exception>How to handle exception</h2><h3 id=try-catch>try catch</h3><p>We should avoid using <code>try catch</code> except calling some unsafe or Java oriented API that provided by thirdparty library. Instead of using <code>try catch</code>, it's recommended to use <code>Try</code> which will be explained in another section.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>def</span> divide<span style=color:#f92672>(</span>m<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>,</span> n<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span> <span style=color:#f92672>=</span>
  m <span style=color:#f92672>/</span> n

<span style=color:#66d9ef>val</span> result <span style=color:#66d9ef>=</span> <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
  divide<span style=color:#f92672>(</span><span style=color:#ae81ff>10</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>case</span> e<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Exception</span> <span style=color:#f92672>=&gt;</span> e<span style=color:#f92672>.</span>getMessage
<span style=color:#f92672>}</span>

<span style=color:#75715e>// result is string: / by zero
</span></code></pre></div><h3 id=option>Option</h3><p>When you don't care about the error information, it's ok to use <code>None</code> along with <code>Option</code> monad to represent the uncared error, and use <code>Some(value)</code> to represent the normal calculation result of a function like following example.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>def</span> divide<span style=color:#f92672>(</span>m<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>,</span> n<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Option</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Int</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
  <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>n <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>)</span> <span style=color:#a6e22e>None</span>
  <span style=color:#66d9ef>else</span> <span style=color:#a6e22e>Some</span><span style=color:#f92672>(</span>m <span style=color:#f92672>/</span> n<span style=color:#f92672>)</span>

<span style=color:#66d9ef>val</span> result <span style=color:#66d9ef>=</span> <span style=color:#66d9ef>for</span> <span style=color:#f92672>{</span>
  a <span style=color:#66d9ef>&lt;-</span> divide<span style=color:#f92672>(</span><span style=color:#ae81ff>10</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>3</span><span style=color:#f92672>)</span>
  b <span style=color:#66d9ef>&lt;-</span> divide<span style=color:#f92672>(</span><span style=color:#ae81ff>7</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span> <span style=color:#66d9ef>yield</span> a <span style=color:#f92672>+</span> b

<span style=color:#75715e>// result is None
</span></code></pre></div><h3 id=either>Either</h3><p><code>Either</code> monad is one of the most frequently used error handling methods. Use <code>Left(error)</code> to represent the error include type inforamtion, <code>Right(value)</code> to represent the normal result.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>def</span> divide<span style=color:#f92672>(</span>m<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>,</span> n<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Either</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span>, <span style=color:#66d9ef>Double</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
  <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>n <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>)</span> <span style=color:#a6e22e>Left</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Divident can&#39;t be zero&#34;</span><span style=color:#f92672>)</span>
  <span style=color:#66d9ef>else</span> <span style=color:#a6e22e>Right</span><span style=color:#f92672>(</span>m <span style=color:#f92672>/</span> n<span style=color:#f92672>)</span>

<span style=color:#66d9ef>val</span> result <span style=color:#66d9ef>=</span> <span style=color:#66d9ef>for</span> <span style=color:#f92672>{</span>
  a <span style=color:#66d9ef>&lt;-</span> divide<span style=color:#f92672>(</span><span style=color:#ae81ff>10</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>3</span><span style=color:#f92672>)</span>
  b <span style=color:#66d9ef>&lt;-</span> divide<span style=color:#f92672>(</span><span style=color:#ae81ff>7</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span> <span style=color:#66d9ef>yield</span> a <span style=color:#f92672>+</span> b

<span style=color:#75715e>// result is Left(&#34;Divident can&#39;t be zero&#34;)
</span></code></pre></div><h3 id=try>Try</h3><p><code>Try</code> monad is another commonly used way to do error handling in Scala. It's used to dealing with some code which will throw exception out of your control like thirdparty library oriented in Java. Better than <code>try catch</code> block, you can get the monad control flow as a bonus. Refer to <a href=https://whisperd.tech/post/understand-monad/>this blog</a> to get more knowledge about monad control flow. With <code>Try</code> monad, you can use <code>Failure(error)</code> for error and <code>Success(value)</code> for nomal value.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>def</span> divide<span style=color:#f92672>(</span>m<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>,</span> n<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Try</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Int</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
  <span style=color:#a6e22e>Try</span><span style=color:#f92672>{</span>
    m <span style=color:#f92672>/</span> n
  <span style=color:#f92672>}</span>

<span style=color:#66d9ef>val</span> result <span style=color:#66d9ef>=</span> <span style=color:#66d9ef>for</span> <span style=color:#f92672>{</span>
  a <span style=color:#66d9ef>&lt;-</span> divide<span style=color:#f92672>(</span><span style=color:#ae81ff>10</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>)</span>
  b <span style=color:#66d9ef>&lt;-</span> divide<span style=color:#f92672>(</span><span style=color:#ae81ff>10</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>3</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span> <span style=color:#66d9ef>yield</span> a <span style=color:#f92672>+</span> b

<span style=color:#75715e>// result is Failure(java.lang.ArithmeticException: / by zero)
</span></code></pre></div><h3 id=validated>Validated</h3><p><code>Validated</code> is the data type provided by <a href=https://github.com/typelevel/cats>cats</a>. It's widely used in scenarios that need accumulating error information, like:</p><ul><li>input form check</li><li>configuration check</li></ul><p>With <code>Validated</code>, user can see all the error information at once, don't need to wait to see next error until fixed previous one. Use <code>Invalid(NonEmptyList(error))</code> when error happens, use <code>Valid(value)</code> when calculation ends properly. <code>NonEmptyList</code> is a <a href=https://typelevel.org/cats/typeclasses/semigroup.html>semigroup</a> defined in cats to fulfill data accumulation.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>def</span> divide<span style=color:#f92672>(</span>m<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>,</span> n<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Validated</span><span style=color:#f92672>[</span><span style=color:#66d9ef>NonEmptyList</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>Int</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
  <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>n <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>)</span> <span style=color:#a6e22e>Invalid</span><span style=color:#f92672>(</span><span style=color:#a6e22e>NonEmptyList</span><span style=color:#f92672>.</span>of<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;one error&#34;</span><span style=color:#f92672>)</span><span style=color:#f92672>)</span>
  <span style=color:#66d9ef>else</span> <span style=color:#a6e22e>Valid</span><span style=color:#f92672>(</span>m <span style=color:#f92672>/</span> n<span style=color:#f92672>)</span>

<span style=color:#66d9ef>val</span> result <span style=color:#66d9ef>=</span> <span style=color:#f92672>(</span>divide4<span style=color:#f92672>(</span><span style=color:#ae81ff>5</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>)</span><span style=color:#f92672>,</span> divide4<span style=color:#f92672>(</span><span style=color:#ae81ff>10</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>)</span><span style=color:#f92672>)</span><span style=color:#f92672>.</span>mapN<span style=color:#f92672>(</span><span style=color:#f92672>(</span><span style=color:#66d9ef>_</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>_</span><span style=color:#f92672>)</span><span style=color:#f92672>)</span>

<span style=color:#75715e>// result is Invalid(NonEmptyList(one error, one error))
</span></code></pre></div><h3 id=monad-error>Monad Error</h3><p><code>MonadError</code> is a monad that abstracts over error handling monad like Option / Either / Try, which means we can writing business code without concerning about the specific error handling monad. In this way, our code becomes more generic and compact.</p><ul><li><code>pure</code>: create a value with a successful result wrapped by the error handling monad.</li><li><code>raiseError</code> – create a value which represents an error.</li><li><code>fromEither / fromTry / fromOption / fromValidated</code> – convert a specific error handling monad into the related MonadError</li><li><code>handleError / handleErrorWith / recover / recoverWith</code> – handle the error scenario and return a successful value.</li></ul><p>One example looks like following code:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>CustomError</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>def</span> errorFromString<span style=color:#f92672>(</span>str<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span>
  <span style=color:#66d9ef>def</span> errorFromThrowable<span style=color:#f92672>(</span>e<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Throwable</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>object</span> <span style=color:#a6e22e>CustomizeError</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>implicit</span> <span style=color:#66d9ef>val</span> <span style=color:#a6e22e>ThrowableCustomError</span> <span style=color:#66d9ef>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CustomError</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Throwable</span><span style=color:#f92672>]</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>def</span> errorFromString<span style=color:#f92672>(</span>str<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Throwable</span> <span style=color:#f92672>=</span>
      <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Exception</span><span style=color:#f92672>(</span>str<span style=color:#f92672>)</span>
    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>def</span> errorFromThrowable<span style=color:#f92672>(</span>e<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Throwable</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Throwable</span> <span style=color:#f92672>=</span>
      e
  <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>def</span> divide<span style=color:#f92672>[</span><span style=color:#66d9ef>F</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>E</span><span style=color:#f92672>]</span><span style=color:#f92672>(</span>m<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>,</span> n<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>)</span><span style=color:#f92672>(</span><span style=color:#66d9ef>implicit</span> monadError<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>MonadError</span><span style=color:#f92672>[</span><span style=color:#66d9ef>F</span>, <span style=color:#66d9ef>E</span><span style=color:#f92672>]</span><span style=color:#f92672>,</span> error<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>CustomError</span><span style=color:#f92672>[</span><span style=color:#66d9ef>E</span><span style=color:#f92672>]</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>F</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Int</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
  <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>n <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>)</span> monadError<span style=color:#f92672>.</span>raiseError<span style=color:#f92672>(</span>error<span style=color:#f92672>.</span>errorFromString<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Divide by 0&#34;</span><span style=color:#f92672>)</span><span style=color:#f92672>)</span>
  <span style=color:#66d9ef>else</span> monadError<span style=color:#f92672>.</span>pure<span style=color:#f92672>(</span>m <span style=color:#f92672>/</span> n<span style=color:#f92672>)</span>

<span style=color:#66d9ef>import</span> cats.implicits._
<span style=color:#66d9ef>val</span> divideTry <span style=color:#66d9ef>=</span> divide<span style=color:#f92672>[</span><span style=color:#66d9ef>Try</span>, <span style=color:#66d9ef>Throwable</span><span style=color:#f92672>]</span><span style=color:#f92672>(</span><span style=color:#ae81ff>10</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>)</span>
</code></pre></div><h3 id=error-handling-with-io-monad>Error Handling with IO Monad</h3><p><code>IO</code> monad is commonly used while dealing with side effects provided by <a href=https://github.com/typelevel/cats-effect>cats-effect</a>. There is an instance of <code>MonadError[IO, Throwable]</code> in cats-effect, all the error handling is done throught it. The convenient function to handle error scenario.</p><ul><li><code>raiseError</code>: constructs an <code>IO</code> which wraps up a Throwable.</li><li><code>attemp</code>: sequence the convertion between exception in IO and Either.</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BusinessException</span><span style=color:#f92672>(</span>msg<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Exception</span><span style=color:#f92672>(</span>msg<span style=color:#f92672>)</span>

<span style=color:#66d9ef>val</span> boom <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>IO</span><span style=color:#f92672>.</span>raiseError<span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>BusinessException</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;error happens&#34;</span><span style=color:#f92672>)</span><span style=color:#f92672>)</span>

boom<span style=color:#f92672>.</span>unsafeRunSync<span style=color:#f92672>(</span><span style=color:#f92672>)</span>

boom<span style=color:#f92672>.</span>attempt<span style=color:#f92672>.</span>map<span style=color:#f92672>{</span>
  <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>Left</span><span style=color:#f92672>(</span><span style=color:#a6e22e>BusinessException</span><span style=color:#f92672>(</span>msg<span style=color:#f92672>)</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> <span style=color:#e6db74>&#34;business error&#34;</span>
  <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>_</span> <span style=color:#66d9ef>=&gt;</span> <span style=color:#e6db74>&#34;other error&#34;</span>
<span style=color:#f92672>}</span><span style=color:#f92672>.</span>unsafeRunSync<span style=color:#f92672>(</span><span style=color:#f92672>)</span>

<span style=color:#66d9ef>val</span> result <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>IO</span><span style=color:#f92672>.</span>delay<span style=color:#f92672>(</span><span style=color:#ae81ff>10</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>)</span><span style=color:#f92672>.</span>flatMap<span style=color:#f92672>(</span>n <span style=color:#66d9ef>=&gt;</span> <span style=color:#a6e22e>IO</span><span style=color:#f92672>(</span>println<span style=color:#f92672>(</span>n<span style=color:#f92672>)</span><span style=color:#f92672>)</span><span style=color:#f92672>)</span>
</code></pre></div><h2 id=summary>Summary</h2><p>Error handling is one of the most important field in programming. FP provides a more graceful way to do it comparing with OO. Review this post and contact me if you got any thoughts.</p><h2 id=reference>Reference</h2><ul><li><a href=https://nrinaudo.github.io/scala-best-practices/referential_transparency/avoid_throwing_exceptions.html>Scala best practice: do not throw exception</a></li><li><a href=https://typelevel.org/cats/datatypes/validated.html>Cats data type: Validated</a></li><li><a href=https://www.javamex.com/tutorials/exceptions/exceptions_hierarchy.shtml>The exception hierarchy in Java</a></li><li><a href=https://pedrorijo.com/blog/scala-exceptions/>Handling exceptions in Scala</a></li><li><a href=https://www.codacy.com/blog/monad-error-for-the-rest-of-us/>Monad Error for the rest of us</a></li><li><a href=https://typelevel.org/cats-effect/datatypes/io.html>Cats Effect: IO</a></li></ul></section></article><footer id=post-meta class=clearfix><a href=https://twitter.com/kaichaosun><img class=avatar src=https://kaichaosun.github.io/images/avatar.png><div><span class=dark>Kaichao Sun</span>
<span>Mark it down</span></div></a><section id=sharing><a class=twitter href="https://twitter.com/intent/tweet?text=https%3a%2f%2fkaichaosun.github.io%2fpost%2ferror_handling_in_scala%2f - Understand%20Error%20Handling%20in%20Scala by @kaichaosun"><span class=icon-twitter>tweet</span></a>
<a class=facebook href=# onclick="window.open('https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),'facebook-share-dialog','width=626,height=436');return false;"><span class=icon-facebook-rect>Share</span></a></section></footer><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"whisperd"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a><ul id=post-list class="archive readmore"><iframe src=https://kaichao.substack.com/embed id=email-subscribe width=100% height=320 style="border:1px solid #eee;background:#fff;margin-top:60px" frameborder=0 scrolling=no></iframe><h3>Read more</h3><li><a href=/post/how_to_blockchain/>如何学习区块链技术<aside class=dates>Apr 30 2020</aside></a></li><li><a href=/post/kusama_governance/>Kusama系列：如何进行链上治理<aside class=dates>Apr 16 2020</aside></a></li><li><a href=/post/substrate_node_template_guide/>Substrate代码导读：node-template<aside class=dates>Apr 2 2020</aside></a></li><li><a href=/post/trie/>理解Substrate数据存储的底层实现Merkle Patricia Trie<aside class=dates>Mar 17 2020</aside></a></li><li><a href=/post/substrate_transaction_weight_and_fees/>Substrate 区块链应用的交易费用设计<aside class=dates>Feb 21 2020</aside></a></li><li><a href=/post/substrate_storage_data_type/>Substrate存储数据类型概览<aside class=dates>Jan 19 2020</aside></a></li><li><a href=/post/coin_flip_test_and_ui/>抛硬币游戏(二)：编写测试和UI<aside class=dates>Oct 3 2019</aside></a></li><li><a href=/post/substrate_coin_flip/>Substrate应用 - 抛硬币游戏(一)<aside class=dates>Aug 5 2019</aside></a></li><li><a href=/post/substrate_blockchain_setup/>使用Substrate搭建你的第一条区块链<aside class=dates>May 28 2019</aside></a></li><li><a href=/post/why_oo_sucks/>Why OO Sucks<aside class=dates>Apr 25 2019</aside></a></li></ul><footer id=footer><div id=social><a class=symbol href=https://github.com/kaichaosun><i class="fa fa-github"></i></a><a class=symbol href=https://twitter.com/kaichaosun><i class="fa fa-twitter"></i></a></div><p class=small>© Copyright 2020 Kaichao Sun</p></footer></section><script src=//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js></script><script src=https://kaichaosun.github.io/js/main.js></script><script src=https://kaichaosun.github.io/js/highlight.js></script><script src=https://kaichaosun.github.io/js/fix-toc.js></script><script>hljs.initHighlightingOnLoad();</script><script data-ad-client=ca-pub-2513693433628672 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-128168145-1','auto');ga('send','pageview');}</script></body></html>