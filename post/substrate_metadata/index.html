<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Kaichao Sun"><meta name=description content="kaichao's blog"><meta name=generator content="Hugo 0.62.2"><title>Substrate Runtime Metadata</title><link rel="shortcut icon" href=https://kaichaosun.github.io/images/favicon.ico><link rel=stylesheet href=https://kaichaosun.github.io/css/style.css><link rel=stylesheet href=https://kaichaosun.github.io/css/highlight.css><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css><meta property="og:title" content="Substrate Runtime Metadata"><meta property="og:description" content="Inspecting a Runtime's Metadata can help you out in the following scenarios:
 You want to interact with a Substrate blockchain, but don't have much idea about what features the blockchain provides. You want to show the available storage entries and dispatchable functions for users who are using the GUI.  Substrate provides module-based metadata to give an overview of your blockchain runtime. It helps an external client to introspect each module's, storage items, dispatchable functions, and events."><meta property="og:type" content="article"><meta property="og:url" content="https://kaichaosun.github.io/post/substrate_metadata/"><meta property="article:published_time" content="2019-09-07T00:00:00+00:00"><meta property="article:modified_time" content="2019-09-07T00:00:00+00:00"><meta itemprop=name content="Substrate Runtime Metadata"><meta itemprop=description content="Inspecting a Runtime's Metadata can help you out in the following scenarios:
 You want to interact with a Substrate blockchain, but don't have much idea about what features the blockchain provides. You want to show the available storage entries and dispatchable functions for users who are using the GUI.  Substrate provides module-based metadata to give an overview of your blockchain runtime. It helps an external client to introspect each module's, storage items, dispatchable functions, and events."><meta itemprop=datePublished content="2019-09-07T00:00:00+00:00"><meta itemprop=dateModified content="2019-09-07T00:00:00+00:00"><meta itemprop=wordCount content="714"><meta itemprop=keywords content="Blockchain,Substrate,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Substrate Runtime Metadata"><meta name=twitter:description content="Inspecting a Runtime's Metadata can help you out in the following scenarios:
 You want to interact with a Substrate blockchain, but don't have much idea about what features the blockchain provides. You want to show the available storage entries and dispatchable functions for users who are using the GUI.  Substrate provides module-based metadata to give an overview of your blockchain runtime. It helps an external client to introspect each module's, storage items, dispatchable functions, and events."><meta name=twitter:site content="@https://twitter.com/kaichaosun"></head><body><nav class=main-nav><a href=https://kaichaosun.github.io/><span class=arrow>←</span>Home</a>
<a href=/about/>About</a>
<a class=cta href=#email-subscribe>Subscribe</a></nav><section id=wrapper><article class=post><header><h1>Substrate Runtime Metadata</h1><h2 class=subtitle></h2><h2 class=headline>September 7, 2019<br><a href=https://kaichaosun.github.io/tags/blockchain>Blockchain</a>
<a href=https://kaichaosun.github.io/tags/substrate>Substrate</a></h2></header><aside><nav id=TableOfContents><ul><li><a href=#srml-metadata>SRML Metadata</a></li><li><a href=#fetch-the-metadata>Fetch The Metadata</a></li></ul></nav></aside><section id=post-body><p>Inspecting a Runtime's Metadata can help you out in the following scenarios:</p><ul><li>You want to interact with a Substrate blockchain, but don't have much idea about what features the blockchain provides.</li><li>You want to show the available storage entries and dispatchable functions for users who are using the GUI.</li></ul><p>Substrate provides module-based metadata to give an overview of your blockchain runtime. It helps an external client to introspect each module's, storage items, dispatchable functions, and events.</p><h2 id=srml-metadata>SRML Metadata</h2><p>In Substrate, the runtime metadata is consolidated and encoded automatically when developing runtime modules. The built-in <a href=https://substrate.dev/rustdocs/v1.0/srml_metadata/index.html>Metadata module</a> doesn't provide any additional storage entries, dispatchable functions or events. It simply provides the data structure to store the metadata of your blockchain runtime, and related codec to convert between raw data and bytes literal in <a href=overview/low-level-data-format.md>SCALE (Simple Concatenated Aggregate Little-Endian)</a> format.</p><p>Before we dive into more detail, let's have a quick look at what information is included in the metadata. For demo purposes, we'll only show metadata of the <a href=https://substrate.dev/rustdocs/v1.0/srml_sudo/index.html>Sudo module</a> in JSON format:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;modules&#34;</span>:[
        {
            <span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;sudo&#34;</span>,
            <span style=color:#f92672>&#34;prefix&#34;</span>:<span style=color:#e6db74>&#34;Sudo&#34;</span>,
            <span style=color:#f92672>&#34;storage&#34;</span>:[
                {
                    <span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;Key&#34;</span>,
                    <span style=color:#f92672>&#34;modifier&#34;</span>:<span style=color:#e6db74>&#34;Default&#34;</span>,
                    <span style=color:#f92672>&#34;type&#34;</span>:{
                        <span style=color:#f92672>&#34;PlainType&#34;</span>:<span style=color:#e6db74>&#34;AccountId&#34;</span>
                    },
                    <span style=color:#f92672>&#34;fallback&#34;</span>:<span style=color:#e6db74>&#34;0x0000000000000000000000000000000000000000000000000000000000000000&#34;</span>,
                    <span style=color:#f92672>&#34;documentation&#34;</span>:[
                        <span style=color:#e6db74>&#34; The `AccountId` of the sudo key.&#34;</span>
                    ]
                }
            ],
            <span style=color:#f92672>&#34;calls&#34;</span>:[
                {
                    <span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;sudo&#34;</span>,
                    <span style=color:#f92672>&#34;args&#34;</span>:[
                        {
                            <span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;proposal&#34;</span>,
                            <span style=color:#f92672>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;Proposal&#34;</span>
                        }
                    ],
                    <span style=color:#f92672>&#34;documentation&#34;</span>:[
                        <span style=color:#e6db74>&#34; Authenticates the sudo key and dispatches a function call with `Root` origin.&#34;</span>
                    ]
                },
                <span style=color:#960050;background-color:#1e0010>.</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#960050;background-color:#1e0010>.</span>
            ],
            <span style=color:#f92672>&#34;events&#34;</span>:[
                {
                    <span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;Sudid&#34;</span>,
                    <span style=color:#f92672>&#34;args&#34;</span>:[
                        <span style=color:#e6db74>&#34;bool&#34;</span>
                    ],
                    <span style=color:#f92672>&#34;documentation&#34;</span>:[
                        <span style=color:#e6db74>&#34; A sudo just took place.&#34;</span>
                    ]
                },
                <span style=color:#960050;background-color:#1e0010>.</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#960050;background-color:#1e0010>.</span>
            ]
        }
    ]
}
</code></pre></div><blockquote><p>Here we are using <code>V4</code> of the runtime metadata. Go to <a href=https://substrate.dev/rustdocs/v1.0/srml_metadata/enum.RuntimeMetadata.html>its reference document</a> for more versioning information.</p></blockquote><p>The metadata of an entire runtime is an array of its modules&rsquo; metadata, including all SRML and custom runtime modules in your blockchain. You can also find <a href=https://github.com/polkadot-js/api/blob/master/packages/types/src/Metadata/v4/latest.substrate.v4.json>the decoded metadata</a> of all build-in modules in Polkadot-js/api.</p><p>Now let's walk through each field in module's metadata:</p><ul><li><code>name</code>: the module's name.</li><li><code>prefix</code>: the name of module's store.</li><li><code>storage</code>: all the available storage entries in the module. Each storage entry is composed of:<ul><li><code>name</code>: the storage entry's name.</li><li><code>modifier</code>: whether the entry is <code>Optional</code> or <code>Default</code>.</li><li><code>type</code>: the type of the storage entry, could be <code>PlainType</code>, <code>MapType</code> or <code>DoubleMapType</code>.</li><li><code>fallback</code>: the default value if the entry has not been set.</li><li><code>documentation</code>: notes for the entry.</li></ul></li><li><code>calls</code>: an array of dispatchable functions:<ul><li><code>name</code>: the function's name.</li><li><code>args</code>: the arguments in function's definition, each includes parameter name and type.</li><li><code>documentation</code>: notes for the function.</li></ul></li><li><code>event</code>: all the defined events in a module:<ul><li><code>name</code>: the event's name.</li><li><code>args</code>: the arguments in the event definition.</li><li><code>documentation</code>: notes for the event.</li></ul></li></ul><h2 id=fetch-the-metadata>Fetch The Metadata</h2><p>If you are using <strong>Javascript</strong>, <a href=https://polkadot.js.org/api/>polkadot-js/api</a> already provides friendly APIs to interact with Substrate blockchain, including the <a href=https://polkadot.js.org/api/METHODS_RPC.html#json-rpc>getMetadata</a> function.
You can try the following code snippets to fetch the metadata in this <a href=https://polkadot.js.org/apps/#/js>Substrate UI</a> page:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>magicNumber</span>, <span style=color:#a6e22e>metadata</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>await</span> <span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>rpc</span>.<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>getMetadata</span>();

<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>( <span style=color:#e6db74>&#39;Magic number: &#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>magicNumber</span> );
<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>( <span style=color:#e6db74>&#39;Metadata: &#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>metadata</span>.<span style=color:#a6e22e>raw</span> );
</code></pre></div><p>If you are using <strong>other languages</strong> to build your client, you can easily send a <strong>WebSocket message</strong> or <strong>HTTP POST request</strong> to a Substrate node endpoint by using any existing client. The message or body for <code>getMetadata</code> is:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#ae81ff>1</span>,
  <span style=color:#f92672>&#34;jsonrpc&#34;</span>: <span style=color:#e6db74>&#34;2.0&#34;</span>,
  <span style=color:#f92672>&#34;method&#34;</span>: <span style=color:#e6db74>&#34;state_getMetadata&#34;</span>,
  <span style=color:#f92672>&#34;params&#34;</span>: []
}
</code></pre></div><p>The response looks like following contents, but with much more information in <code>result</code> field:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;jsonrpc&#34;</span>: <span style=color:#e6db74>&#34;2.0&#34;</span>,
    <span style=color:#f92672>&#34;result&#34;</span>: <span style=color:#e6db74>&#34;0x6d65746104241873797374656d1853797374656d012c304163636f756e744e6f6e636501010130543a3a4163636f756e74...&#34;</span>,
    <span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#ae81ff>1</span>
}
</code></pre></div><p>The hexadecimal string in the <code>result</code> field wraps the runtime metadata in SCALE format. Go to <a href=overview/low-level-data-format.md>Low-level Data Format</a> page to learn how to decode different types and get more information about the specification and implementations.</p><p>Our hex blob starts with a hard coded magic number <code>6d657461</code> which represents <em>meta</em> in plain text. The next piece of data shows the version number of the metadata, here we are using <code>04</code> to represent version 4. We already mentioned that runtime metadata is composed by available modules. In our case we have 9 modules. After shifting 9 in binary representation two bits to the left, we get <code>24</code> in hex to represent the length of the array.</p><p>The remaining blob encodes the metadata of each module. Learning more about decoding different types in the <a href=https://substrate.dev/rustdocs/v1.0/srml_metadata/struct.ModuleMetadata.html>struct</a>, please refer to the <a href=https://substrate.dev/rustdocs/v1.0/srml_metadata/index.html>reference docs</a> and <a href=overview/low-level-data-format.md>Low-level Data Format</a> page.</p><p>After decoding the hex blob successfully, you should be able to see similar metadata in the above example.</p></section></article><footer id=post-meta class=clearfix><a href=https://twitter.com/kaichaosun><img class=avatar src=https://kaichaosun.github.io/images/avatar.png><div><span class=dark>Kaichao Sun</span>
<span>Mark it down</span></div></a><section id=sharing><a class=twitter href="https://twitter.com/intent/tweet?text=https%3a%2f%2fkaichaosun.github.io%2fpost%2fsubstrate_metadata%2f - Substrate%20Runtime%20Metadata by @kaichaosun"><span class=icon-twitter>tweet</span></a>
<a class=facebook href=# onclick="window.open('https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),'facebook-share-dialog','width=626,height=436');return false;"><span class=icon-facebook-rect>Share</span></a></section></footer><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"whisperd"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a><ul id=post-list class="archive readmore"><iframe src=https://kaichao.substack.com/embed id=email-subscribe width=100% height=320 style="border:1px solid #eee;background:#fff;margin-top:60px" frameborder=0 scrolling=no></iframe><h3>Read more</h3><li><a href=/post/metaverse/>你的元宇宙会不会把我从 “一条人” 变成 “一条狗”？<aside class=dates>Jan 21 2022</aside></a></li><li><a href=/post/substrate_network_libp2p/>Substrate 如何使用 libp2p 进行点对点通信<aside class=dates>Feb 8 2021</aside></a></li><li><a href=/post/substrate_read_source_code/>阅读Substrate源码的方法<aside class=dates>Jan 6 2021</aside></a></li><li><a href=/post/learn_substrate/>如何学习Substrate<aside class=dates>Jul 20 2020</aside></a></li><li><a href=/post/substrate_launch_public_testnet/>Substrate 部署公开测试网络<aside class=dates>Jul 17 2020</aside></a></li><li><a href=/post/how_to_blockchain/>如何学习区块链技术<aside class=dates>Apr 30 2020</aside></a></li><li><a href=/post/kusama_governance/>Kusama系列：如何进行链上治理<aside class=dates>Apr 16 2020</aside></a></li><li><a href=/post/substrate_node_template_guide/>Substrate代码导读：node-template<aside class=dates>Apr 2 2020</aside></a></li><li><a href=/post/trie/>理解Substrate数据存储的底层实现Merkle Patricia Trie<aside class=dates>Mar 17 2020</aside></a></li><li><a href=/post/substrate_transaction_weight_and_fees/>Substrate 区块链应用的交易费用设计<aside class=dates>Feb 21 2020</aside></a></li><li><a href=/post/substrate_storage_data_type/>Substrate存储数据类型概览<aside class=dates>Jan 19 2020</aside></a></li><li><a href=/post/coin_flip_test_and_ui/>抛硬币游戏(二)：编写测试和UI<aside class=dates>Oct 3 2019</aside></a></li><li><a href=/post/substrate_coin_flip/>Substrate应用 - 抛硬币游戏(一)<aside class=dates>Aug 5 2019</aside></a></li><li><a href=/post/substrate_module_struct/>Substrate Module Struct<aside class=dates>Jul 30 2019</aside></a></li><li><a href=/post/substrate_blockchain_setup/>使用Substrate搭建你的第一条区块链<aside class=dates>May 28 2019</aside></a></li><li><a href=/post/why_oo_sucks/>Why OO Sucks<aside class=dates>Apr 25 2019</aside></a></li><li><a href=/post/solidity-basics/>理解Ethereum智能合约开发<aside class=dates>Apr 11 2019</aside></a></li><li><a href=/post/shell-cheatsheet/>Cheatsheet for Shell Programming<aside class=dates>Mar 30 2019</aside></a></li><li><a href=/post/master_linux_os/>The Tutorial of Manjaro Linux Usage<aside class=dates>Mar 3 2019</aside></a></li><li><a href=/post/laozhai-jiyi/>老宅记忆<aside class=dates>Feb 6 2019</aside></a></li></ul><footer id=footer><div id=social><a class=symbol href=https://github.com/kaichaosun><i class="fa fa-github"></i></a><a class=symbol href=https://twitter.com/kaichaosun><i class="fa fa-twitter"></i></a></div><p class=small>© Copyright 2022 Kaichao Sun</p></footer></section><script src=//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js></script><script src=https://kaichaosun.github.io/js/main.js></script><script src=https://kaichaosun.github.io/js/highlight.js></script><script src=https://kaichaosun.github.io/js/fix-toc.js></script><script>hljs.initHighlightingOnLoad();</script><script data-ad-client=ca-pub-2513693433628672 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-128168145-1','auto');ga('send','pageview');}</script></body></html>