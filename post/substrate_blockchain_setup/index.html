<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Kaichao Sun"><meta name=description content="kaichao's blog"><meta name=generator content="Hugo 0.62.2"><title>使用Substrate搭建你的第一条区块链</title><link rel="shortcut icon" href=https://kaichaosun.github.io/images/favicon.ico><link rel=stylesheet href=https://kaichaosun.github.io/css/style.css><link rel=stylesheet href=https://kaichaosun.github.io/css/highlight.css><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css><link href=https://kaichaosun.github.io/index.xml rel=alternate type=application/rss+xml title=Whisperd><meta property="og:title" content="使用Substrate搭建你的第一条区块链"><meta property="og:description" content="为什么使用区块链 比特币网络作为最早的区块链网络，已经存在了十年时间。在今天，区块链技术还没有像互联网那样深刻地改变着我们每个人的生活，但是它的优势已经在一些行业和领域展现出来，比如国际支付、金融衍生品交易、预测市场、去中心化自治组织等。
区块链或者更准确的说是去中心账本，相对于传统互联网行业有其天生的优势，比如：
 永不离线 - 安全的公有链又全球数以万计的计算机节点共同维护，理论上讲只要还有一个节点可供访问，数据就不会丢失。 开源审查 - 绝大部分区块链应用的代码都是开源的，供全世界的开发人员审查，除了能够提升代码质量，开源运动更为深远的意义在于通过分享促进着人类社会的进步。 数据加密 - 密码学技术是去中心账本的基石，保证数据不被篡改，让数据更加安全。 保护隐私 - 每一个用户都是链上的一个账户，而账户的所有信息完全由掌握账户所对应私钥的用户控制着，除非用户自己公开或者交易数据，否则数据不会泄露。 分享权益 - 用户可以通过参与到区块链的安全运转机制中，获取到原本只有中心化的企业才能拿到的权益。  随着区块链技术的不断演进，交易成本、确认时间、能源消耗、安全性、互通性都得到了极大地提升，传统互联网企业在相同的产业领域将面临着具有以上所说优势的区块链企业的挑战。
现在处在优势地位的传统互联网&#34;独角兽&rdquo;，如果依靠区块链技术成功转型，能够确保在未来不会被轻易淘汰；
处于劣势地位的小企业或者小团队，通过在链上实现业务，可以达到&#34;四两拨千斤&#34;的竞争优势。
然而区块链的开发依赖多学科的知识技能，比如密码学、高效点对点网络、软件工程、经济学模型等等，小团队甚至是大企业都很难具备这样的人才资源，对于&#34;上链&#34;大多数人都是心有余而力不足。Substrate的出现就是为了解决这个问题。
什么是Substrate Substrate是由德国Parity公司推出的一个区块链构建框架。它实现了区块链开发领域中所遇到的大部分通用功能，比如点对点网络连接，可配置的共识算法，常用加密算法，数据库存储，交易管理等。通过使用Substrate，使普通的软件开发人员可以在短时间内建立一条属于自己的完整区块链，开发者只需要关注自己的业务逻辑，从底层复杂的技术中解放出来。
使用Substrate构建的区块链，有一个额外的好处，就是可以轻易地连接到Parity的Polkadot公链网络，这一网络具有很多优势，比如跨链交易、共享安全等。
Substrate是由Rust语言开发，而Rust最为一门高级静态编程语言，具有诸多优势，如内存安全、类型检查、支持编译为WASM、函数式友好、社区资料完善等优点。通过借助Rust的优良特性，也使得Substrate的性能优良、可读性高。
你也可以参考Substrate官方参考文档来了解更多。
下面，进入今天我们的主要任务，使用Substrate来构建一条本地的测试区块链网络。
搭建区块链 通过这一节，你会学到：
 如何创建和编译节点程序 如何启动节点程序及各项参数配置 不同的节点网络有什么区别 如何修改chainspec文件  准备环境  Mac OS 或者Linux计算机 Git  创建和编译节点程序 方式一  安装依赖工具，如Rust环境、openssl、cmake、 llvm库：  curl https://getsubstrate.io -sSf | bash 如果感兴趣上面脚本的具体执行内容，可以参考这里。由于国内网络原因，以上脚本可能会下载失败或者过慢，参考下面的方法配置国内的Rust仓库镜像进行下载。
git clone https://github.com/kaichaosun/getsubstrate-cn cd substrate-cn cp config ~/.cargo/config ./getsubstrate 新建节点程序，使用命令行导航至你想要放置节点程序的目录，执行：  substrate-node-new substrate-demo-node someone 你也可以替换substrate-demo-node为你想要的节点程序名，替换someone为你自己的名字。等待命令执行完后，一个属于自己的节点程序就完成了。"><meta property="og:type" content="article"><meta property="og:url" content="https://kaichaosun.github.io/post/substrate_blockchain_setup/"><meta property="article:published_time" content="2019-05-28T00:00:00+00:00"><meta property="article:modified_time" content="2019-05-28T00:00:00+00:00"><meta itemprop=name content="使用Substrate搭建你的第一条区块链"><meta itemprop=description content="为什么使用区块链 比特币网络作为最早的区块链网络，已经存在了十年时间。在今天，区块链技术还没有像互联网那样深刻地改变着我们每个人的生活，但是它的优势已经在一些行业和领域展现出来，比如国际支付、金融衍生品交易、预测市场、去中心化自治组织等。
区块链或者更准确的说是去中心账本，相对于传统互联网行业有其天生的优势，比如：
 永不离线 - 安全的公有链又全球数以万计的计算机节点共同维护，理论上讲只要还有一个节点可供访问，数据就不会丢失。 开源审查 - 绝大部分区块链应用的代码都是开源的，供全世界的开发人员审查，除了能够提升代码质量，开源运动更为深远的意义在于通过分享促进着人类社会的进步。 数据加密 - 密码学技术是去中心账本的基石，保证数据不被篡改，让数据更加安全。 保护隐私 - 每一个用户都是链上的一个账户，而账户的所有信息完全由掌握账户所对应私钥的用户控制着，除非用户自己公开或者交易数据，否则数据不会泄露。 分享权益 - 用户可以通过参与到区块链的安全运转机制中，获取到原本只有中心化的企业才能拿到的权益。  随着区块链技术的不断演进，交易成本、确认时间、能源消耗、安全性、互通性都得到了极大地提升，传统互联网企业在相同的产业领域将面临着具有以上所说优势的区块链企业的挑战。
现在处在优势地位的传统互联网&#34;独角兽&rdquo;，如果依靠区块链技术成功转型，能够确保在未来不会被轻易淘汰；
处于劣势地位的小企业或者小团队，通过在链上实现业务，可以达到&#34;四两拨千斤&#34;的竞争优势。
然而区块链的开发依赖多学科的知识技能，比如密码学、高效点对点网络、软件工程、经济学模型等等，小团队甚至是大企业都很难具备这样的人才资源，对于&#34;上链&#34;大多数人都是心有余而力不足。Substrate的出现就是为了解决这个问题。
什么是Substrate Substrate是由德国Parity公司推出的一个区块链构建框架。它实现了区块链开发领域中所遇到的大部分通用功能，比如点对点网络连接，可配置的共识算法，常用加密算法，数据库存储，交易管理等。通过使用Substrate，使普通的软件开发人员可以在短时间内建立一条属于自己的完整区块链，开发者只需要关注自己的业务逻辑，从底层复杂的技术中解放出来。
使用Substrate构建的区块链，有一个额外的好处，就是可以轻易地连接到Parity的Polkadot公链网络，这一网络具有很多优势，比如跨链交易、共享安全等。
Substrate是由Rust语言开发，而Rust最为一门高级静态编程语言，具有诸多优势，如内存安全、类型检查、支持编译为WASM、函数式友好、社区资料完善等优点。通过借助Rust的优良特性，也使得Substrate的性能优良、可读性高。
你也可以参考Substrate官方参考文档来了解更多。
下面，进入今天我们的主要任务，使用Substrate来构建一条本地的测试区块链网络。
搭建区块链 通过这一节，你会学到：
 如何创建和编译节点程序 如何启动节点程序及各项参数配置 不同的节点网络有什么区别 如何修改chainspec文件  准备环境  Mac OS 或者Linux计算机 Git  创建和编译节点程序 方式一  安装依赖工具，如Rust环境、openssl、cmake、 llvm库：  curl https://getsubstrate.io -sSf | bash 如果感兴趣上面脚本的具体执行内容，可以参考这里。由于国内网络原因，以上脚本可能会下载失败或者过慢，参考下面的方法配置国内的Rust仓库镜像进行下载。
git clone https://github.com/kaichaosun/getsubstrate-cn cd substrate-cn cp config ~/.cargo/config ./getsubstrate 新建节点程序，使用命令行导航至你想要放置节点程序的目录，执行：  substrate-node-new substrate-demo-node someone 你也可以替换substrate-demo-node为你想要的节点程序名，替换someone为你自己的名字。等待命令执行完后，一个属于自己的节点程序就完成了。"><meta itemprop=datePublished content="2019-05-28T00:00:00+00:00"><meta itemprop=dateModified content="2019-05-28T00:00:00+00:00"><meta itemprop=wordCount content="355"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="使用Substrate搭建你的第一条区块链"><meta name=twitter:description content="为什么使用区块链 比特币网络作为最早的区块链网络，已经存在了十年时间。在今天，区块链技术还没有像互联网那样深刻地改变着我们每个人的生活，但是它的优势已经在一些行业和领域展现出来，比如国际支付、金融衍生品交易、预测市场、去中心化自治组织等。
区块链或者更准确的说是去中心账本，相对于传统互联网行业有其天生的优势，比如：
 永不离线 - 安全的公有链又全球数以万计的计算机节点共同维护，理论上讲只要还有一个节点可供访问，数据就不会丢失。 开源审查 - 绝大部分区块链应用的代码都是开源的，供全世界的开发人员审查，除了能够提升代码质量，开源运动更为深远的意义在于通过分享促进着人类社会的进步。 数据加密 - 密码学技术是去中心账本的基石，保证数据不被篡改，让数据更加安全。 保护隐私 - 每一个用户都是链上的一个账户，而账户的所有信息完全由掌握账户所对应私钥的用户控制着，除非用户自己公开或者交易数据，否则数据不会泄露。 分享权益 - 用户可以通过参与到区块链的安全运转机制中，获取到原本只有中心化的企业才能拿到的权益。  随着区块链技术的不断演进，交易成本、确认时间、能源消耗、安全性、互通性都得到了极大地提升，传统互联网企业在相同的产业领域将面临着具有以上所说优势的区块链企业的挑战。
现在处在优势地位的传统互联网&#34;独角兽&rdquo;，如果依靠区块链技术成功转型，能够确保在未来不会被轻易淘汰；
处于劣势地位的小企业或者小团队，通过在链上实现业务，可以达到&#34;四两拨千斤&#34;的竞争优势。
然而区块链的开发依赖多学科的知识技能，比如密码学、高效点对点网络、软件工程、经济学模型等等，小团队甚至是大企业都很难具备这样的人才资源，对于&#34;上链&#34;大多数人都是心有余而力不足。Substrate的出现就是为了解决这个问题。
什么是Substrate Substrate是由德国Parity公司推出的一个区块链构建框架。它实现了区块链开发领域中所遇到的大部分通用功能，比如点对点网络连接，可配置的共识算法，常用加密算法，数据库存储，交易管理等。通过使用Substrate，使普通的软件开发人员可以在短时间内建立一条属于自己的完整区块链，开发者只需要关注自己的业务逻辑，从底层复杂的技术中解放出来。
使用Substrate构建的区块链，有一个额外的好处，就是可以轻易地连接到Parity的Polkadot公链网络，这一网络具有很多优势，比如跨链交易、共享安全等。
Substrate是由Rust语言开发，而Rust最为一门高级静态编程语言，具有诸多优势，如内存安全、类型检查、支持编译为WASM、函数式友好、社区资料完善等优点。通过借助Rust的优良特性，也使得Substrate的性能优良、可读性高。
你也可以参考Substrate官方参考文档来了解更多。
下面，进入今天我们的主要任务，使用Substrate来构建一条本地的测试区块链网络。
搭建区块链 通过这一节，你会学到：
 如何创建和编译节点程序 如何启动节点程序及各项参数配置 不同的节点网络有什么区别 如何修改chainspec文件  准备环境  Mac OS 或者Linux计算机 Git  创建和编译节点程序 方式一  安装依赖工具，如Rust环境、openssl、cmake、 llvm库：  curl https://getsubstrate.io -sSf | bash 如果感兴趣上面脚本的具体执行内容，可以参考这里。由于国内网络原因，以上脚本可能会下载失败或者过慢，参考下面的方法配置国内的Rust仓库镜像进行下载。
git clone https://github.com/kaichaosun/getsubstrate-cn cd substrate-cn cp config ~/.cargo/config ./getsubstrate 新建节点程序，使用命令行导航至你想要放置节点程序的目录，执行：  substrate-node-new substrate-demo-node someone 你也可以替换substrate-demo-node为你想要的节点程序名，替换someone为你自己的名字。等待命令执行完后，一个属于自己的节点程序就完成了。"><meta name=twitter:site content="@https://twitter.com/kaichaosun"></head><body><nav class=main-nav><a href=https://kaichaosun.github.io/><span class=arrow>←</span>Home</a>
<a href=/about/>About</a>
<a class=cta href=https://kaichaosun.github.io/index.xml>Subscribe</a></nav><section id=wrapper><article class=post><header><h1>使用Substrate搭建你的第一条区块链</h1><h2 class=subtitle></h2><h2 class=headline>May 28, 2019<br></h2></header><aside><nav id=TableOfContents><ul><li><a href=#为什么使用区块链>为什么使用区块链</a></li><li><a href=#什么是substrate>什么是Substrate</a></li><li><a href=#搭建区块链>搭建区块链</a><ul><li><a href=#准备环境>准备环境</a></li><li><a href=#创建和编译节点程序>创建和编译节点程序</a></li><li><a href=#本地开发网络>本地开发网络</a></li><li><a href=#本地多节点测试网络>本地多节点测试网络</a></li><li><a href=#使用新账户启动本地测试网络>使用新账户启动本地测试网络</a></li></ul></li><li><a href=#总结>总结</a></li><li><a href=#参考资料>参考资料</a></li></ul></nav></aside><section id=post-body><h2 id=为什么使用区块链>为什么使用区块链</h2><p>比特币网络作为最早的区块链网络，已经存在了十年时间。在今天，区块链技术还没有像互联网那样深刻地改变着我们每个人的生活，但是它的优势已经在一些行业和领域展现出来，比如国际支付、金融衍生品交易、预测市场、去中心化自治组织等。</p><p>区块链或者更准确的说是去中心账本，相对于传统互联网行业有其天生的优势，比如：</p><ul><li><strong>永不离线</strong> - 安全的公有链又全球数以万计的计算机节点共同维护，理论上讲只要还有一个节点可供访问，数据就不会丢失。</li><li><strong>开源审查</strong> - 绝大部分区块链应用的代码都是开源的，供全世界的开发人员审查，除了能够提升代码质量，开源运动更为深远的意义在于通过分享促进着人类社会的进步。</li><li><strong>数据加密</strong> - 密码学技术是去中心账本的基石，保证数据不被篡改，让数据更加安全。</li><li><strong>保护隐私</strong> - 每一个用户都是链上的一个账户，而账户的所有信息完全由掌握账户所对应私钥的用户控制着，除非用户自己公开或者交易数据，否则数据不会泄露。</li><li><strong>分享权益</strong> - 用户可以通过参与到区块链的安全运转机制中，获取到原本只有中心化的企业才能拿到的权益。</li></ul><p>随着区块链技术的不断演进，交易成本、确认时间、能源消耗、安全性、互通性都得到了极大地提升，传统互联网企业在相同的产业领域将面临着具有以上所说优势的区块链企业的挑战。</p><p>现在处在优势地位的传统互联网"独角兽&rdquo;，如果依靠区块链技术成功转型，能够确保在未来不会被轻易淘汰；</p><p>处于劣势地位的小企业或者小团队，通过在链上实现业务，可以达到"四两拨千斤"的竞争优势。</p><p>然而区块链的开发依赖多学科的知识技能，比如密码学、高效点对点网络、软件工程、经济学模型等等，小团队甚至是大企业都很难具备这样的人才资源，对于"上链"大多数人都是心有余而力不足。Substrate的出现就是为了解决这个问题。</p><h2 id=什么是substrate>什么是Substrate</h2><p><a href=https://github.com/paritytech/substrate>Substrate</a>是由德国<a href=https://github.com/paritytech/substrate>Parity</a>公司推出的一个<strong>区块链构建框架</strong>。它实现了区块链开发领域中所遇到的大部分通用功能，比如点对点网络连接，可配置的共识算法，常用加密算法，数据库存储，交易管理等。通过使用Substrate，使普通的软件开发人员可以在短时间内建立一条<strong>属于自己的完整区块链</strong>，开发者只需要关注自己的业务逻辑，从底层复杂的技术中解放出来。</p><p>使用Substrate构建的区块链，有一个额外的好处，就是可以轻易地连接到Parity的Polkadot公链网络，这一网络具有很多优势，比如<strong>跨链交易</strong>、<strong>共享安全</strong>等。</p><p>Substrate是由Rust语言开发，而Rust最为一门高级静态编程语言，具有诸多优势，如内存安全、类型检查、支持编译为WASM、函数式友好、社区资料完善等优点。通过借助Rust的优良特性，也使得Substrate的性能优良、可读性高。</p><p>你也可以参考Substrate官方<a href=https://docs.substrate.dev/docs>参考文档</a>来了解更多。</p><p>下面，进入今天我们的主要任务，使用Substrate来构建一条本地的测试区块链网络。</p><h2 id=搭建区块链>搭建区块链</h2><p>通过这一节，你会学到：</p><ul><li>如何创建和编译节点程序</li><li>如何启动节点程序及各项参数配置</li><li>不同的节点网络有什么区别</li><li>如何修改chainspec文件</li></ul><h3 id=准备环境>准备环境</h3><ul><li>Mac OS 或者Linux计算机</li><li>Git</li></ul><h3 id=创建和编译节点程序>创建和编译节点程序</h3><h4 id=方式一>方式一</h4><ol><li>安装依赖工具，如Rust环境、openssl、cmake、 llvm库：</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>curl https://getsubstrate.io -sSf | bash
</code></pre></div><p>如果感兴趣上面脚本的具体执行内容，可以参考<a href=https://getsubstrate.io>这里</a>。由于国内网络原因，以上脚本可能会下载失败或者过慢，参考下面的方法配置国内的Rust仓库镜像进行下载。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/kaichaosun/getsubstrate-cn

cd substrate-cn

cp config ~/.cargo/config

./getsubstrate
</code></pre></div><ol start=2><li>新建节点程序，使用命令行导航至你想要放置节点程序的目录，执行：</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>substrate-node-new substrate-demo-node someone
</code></pre></div><p>你也可以替换<code>substrate-demo-node</code>为你想要的节点程序名，替换<code>someone</code>为你自己的名字。等待命令执行完后，一个属于自己的节点程序就完成了。</p><p>注：<code>substrate-node-new</code>命令会帮你拷贝substrate<a href=https://github.com/paritytech/substrate/tree/master/node-template>模板节点程序</a>、初始化WASM的构建环境、编译Rust代码为WASM等，具体内容参考<a href=https://github.com/paritytech/substrate-up/blob/master/substrate-node-new>链接</a>。</p><p>如果发生了代码改动，就需要重新编译。</p><p>首先，编译Rust代码为WASM：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>./build.sh
</code></pre></div><p>之后，编译生成可执行程序：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>cargo build --release
</code></pre></div><p>可执行程序被放为<code>target/release/template-node</code>。</p><h4 id=方式二>方式二</h4><p>另外一种创建节点的方式是通过拷贝substrate的Git源码，编译node-template：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/paritytech/substrate

git checkout -b v1.0

cd substrate

cd node-template

<span style=color:#75715e># 初始化WASM的构建环境</span>
./scripts/init.sh

<span style=color:#75715e># 编译Rust代码为WASM</span>
./scripts/build.sh

<span style=color:#75715e># 生成可执行程序</span>
cargo build --release
</code></pre></div><p>这种方式适合对substrate源码有一定了解的人，<strong>如果是初学者，建议用上面第一种方式</strong>。</p><h3 id=本地开发网络>本地开发网络</h3><p>首先清空节点数据库：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>./target/release/template-node purge-chain --dev
</code></pre></div><p>然后启动节点程序：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>./target/release/template-node --dev
</code></pre></div><p><code>--dev</code>表示我们准备启动一个本地开发链，会自动初始化开发环境所需的数据和配置。</p><p>如果出现了类似下图所示地内容，那恭喜你成功创建了一条本地开发链。</p><p><img src=https://imgur.com/IvBT3Kf.png alt=dev_node></p><p>现在你可以访问<a href=https://substrate-ui.parity.io>https://substrate-ui.parity.io</a>，选择Settings，将remote node设置为Local Node (127.0.0.1:9944)，如下图所示：</p><p><img src=https://imgur.com/MhHLXwb.png alt=ui_local_node></p><p>选择Explorer，就能够看到最新的区块在不断产生。</p><p>下面，我们来发送一笔交易，选择Extrinsics，<code>submit the following extrinsic</code>选择为<code>balances</code> <code>transfer(dest, value)</code>，<code>dest: Address</code>选择为<code>BOB</code>，<code>value: Compact&lt;Balance></code>设置为你想转账的金额，之后点击Submit Transaction，几秒钟之后会弹出交易成功的提示，这个时候你可以看到Alice的金额减少了，当切换<code>using the selected account</code>为Bob之后，可以看到他的金额增加。</p><p>接下来请你要独立地尝试这个页面上的不同功能，不用担心把辛苦搭建的链玩坏，这也是Substrate的一个好处，可以快速清理垃圾数据。</p><h3 id=本地多节点测试网络>本地多节点测试网络</h3><p>这里我们使用本地测试网络内置的账户，首先启动Alice节点：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>./target/release/template-node <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --base-path /tmp/alice <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --chain<span style=color:#f92672>=</span>local <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --key //Alice <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --port <span style=color:#ae81ff>30333</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --telemetry-url ws://telemetry.polkadot.io:1024 <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --validator <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --name AlicesNode
</code></pre></div><p>命令行参数的涵义如下：</p><ul><li><code>--base-path /tmp/alice</code>：节点数据所存储的位置</li><li><code>--chain=local</code>：指定了节点所处的网络类型，这里<code>local</code>表示本地测试网络，<code>dev</code>表示本地开发，<code>staging</code>表示公开测试网络</li><li><code>--key //Alice</code>：模块节点程序启动时需要私钥，这里我们用了预置的Alice用户私钥</li><li><code>--port 30333</code>：指定p2p协议的TCP端口</li><li><code>--telemetry-url ws://telemetry.polkadot.io:1024</code>：将节点的监控数据发送到指定的监控服务器</li><li><code>--validator</code>：启用validator模式，参与区块生产</li><li><code>--name AlicesNode</code>：指定节点名</li></ul><p>命令执行之后，应该能看到以下启动信息：</p><p><img src=https://i.imgur.com/DIINlNw.png alt=alice_node></p><p>打开一个新的命令行窗口，启动Bob节点：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>./target/release/template-node <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --base-path /tmp/bob <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --chain<span style=color:#f92672>=</span>local <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --key //Bob <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --port <span style=color:#ae81ff>30334</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --telemetry-url ws://telemetry.polkadot.io:1024 <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --validator <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --name BobsNode <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --bootnodes /ip4/127.0.0.1/tcp/30333/p2p/QmRhEhiX8QHVW87wKCTp3qKyY1X21ycKXKdDBrqSR74NWx
</code></pre></div><p>这里，我们为Bob节点指定了不同的数据存储路径、p2p端口等，<code>--bootnodes</code>指明了依赖的启动节点信息，这里使用了Alice节点作为启动节点，<code>30333</code>为Alice节点的端口，<code>QmRhEhiX8QHVW87wKCTp3qKyY1X21ycKXKdDBrqSR74NWx</code>为Alice的节点ID。</p><p>如果一切正常，你应该能够看到：</p><pre><code>Idle (1 peers), best: #2 (0x5155…5b72), finalized #0 (0x146f…317f), ⬇ 24 B/s ⬆ 0.1kiB/s
</code></pre><p>表示Bob节点连接到Alice节点上了(1 peers)，并且新产生的区块没有最终确定<code>finalized #0 (0x146f…317f)</code>，这是因为模块节点程序没有最终确定性这一功能，想要了解更多，请查看官方文档或者留意我的后续文章。</p><p>然后，和之前的方式相同，在浏览器访问区块的信息。</p><h3 id=使用新账户启动本地测试网络>使用新账户启动本地测试网络</h3><p><strong>生成新账户</strong></p><p>如果我们不想用预置的Alice和Bob账户启动网络，就需要执行<code>subkey -e generate</code>命令生成新账户，生成的内容包含私钥seed，公钥public key和交易地址Address：</p><p>账户1：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>Phrase <span style=color:#e6db74>`</span>gas ride shoe victory oil young music trend kingdom rookie south harbor<span style=color:#e6db74>`</span> is account:
  Seed: 0x9aaae371d50d1109fee8595398e54a86f6c79b116ba1894e8207f503708f7d0f
  Public key <span style=color:#f92672>(</span>hex<span style=color:#f92672>)</span>: 0xcc706bd768a54054ac70b3f5568d0103e0f70a2f878e37949e125dd7456ee180
  Address <span style=color:#f92672>(</span>SS58<span style=color:#f92672>)</span>: 5Ggm2DMCG1LRcXUjGE6toVmyHKVSNutzSbUrvQv5gbr5BC6S
</code></pre></div><p>账户2：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>Phrase <span style=color:#e6db74>`</span>real during evidence worry mountain plastic depth desert actress infant age pill<span style=color:#e6db74>`</span> is account:
  Seed: 0x16208851b59f7c6a383a70342fa0893169c7c3190c543d44bd42833f61e54a56
  Public key <span style=color:#f92672>(</span>hex<span style=color:#f92672>)</span>: 0xd6147f4bbb0eeb925e61b31fbed45ab1e3c45fed8d36ce4161c99956dfdf8f9b
  Address <span style=color:#f92672>(</span>SS58<span style=color:#f92672>)</span>: 5GuQCAzXM5xcJfEinUgWnB7PFn2ZGhQfAKAdGRhacRHsXWE9
</code></pre></div><p>将生成的内容安全地保存起来，通过分享地址给其它节点，实现p2p的连接。</p><p>注：如果没有subkey命令，需要到substrate源码目录下重新编译生成<code>cargo install --force --path subkey subkey</code>。</p><p><strong>构造chainspec文件</strong></p><p>Substrate区块链的初始启动信息在<code>chainspec</code>的json文件中维护着，首先生成一个local测试网络的chainspec:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>./target/release/template-node build-spec --chain<span style=color:#f92672>=</span>local &gt; localspec.json
</code></pre></div><p>编辑<code>localspec.json</code>，修改<code>authorities</code>为新生成用户的地址，其它不用修改：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#e6db74>&#34;consensus&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
	<span style=color:#f92672>&#34;authorities&#34;</span>: [
		<span style=color:#e6db74>&#34;5Ggm2DMCG1LRcXUjGE6toVmyHKVSNutzSbUrvQv5gbr5BC6S&#34;</span>,
		<span style=color:#e6db74>&#34;5GuQCAzXM5xcJfEinUgWnB7PFn2ZGhQfAKAdGRhacRHsXWE9&#34;</span>
	],
	<span style=color:#f92672>&#34;code&#34;</span>: <span style=color:#e6db74>&#34;0x0061736d01000000018b011660027...&#34;</span>
}
</code></pre></div><p>修改完后，转换chainspec为原始格式，区别是原始格式的chainspec中所有的字段名都用十六进制进行了编码：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>./target/release/template-node build-spec --chain localspec.json --raw &gt; customspec.json
</code></pre></div><p><strong>启动节点</strong></p><p>启动账户1的节点：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>./target/release/template-node <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --base-path /tmp/account1 <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --chain ./customspec.json <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --key 0x9aaae371d50d1109fee8595398e54a86f6c79b116ba1894e8207f503708f7d0f <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --port <span style=color:#ae81ff>30333</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --telemetry-url ws://telemetry.polkadot.io:1024 <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --validator <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --name Account1Node
</code></pre></div><p>这里，<code>--chain ./customspec.json</code>是启动区块链所需的chainspec文件。</p><p>启动账户2的几点：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>./target/release/template-node <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --base-path /tmp/account2 <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --chain ./customspec.json <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --key 0x16208851b59f7c6a383a70342fa0893169c7c3190c543d44bd42833f61e54a56 <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --port <span style=color:#ae81ff>30334</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --telemetry-url ws://telemetry.polkadot.io:1024 <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --validator <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --name Account2Node <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --bootnodes /ip4/127.0.0.1/tcp/30333/p2p/5Ggm2DMCG1LRcXUjGE6toVmyHKVSNutzSbUrvQv5gbr5BC6S
</code></pre></div><p>这时候你已经拥有了属于自己的第一条区块链！</p><h2 id=总结>总结</h2><p>恭喜你，完成了substrate搭建区块链的第一堂课，我们回顾一下学到的内容，包括安装substrate的依赖环境，创建和编译节点程序，启动测试网络，修改chainspec等等。社区提供了很多的资料供参考，也可以关注知乎专栏<a href=https://zhuanlan.zhihu.com/substrate>《Substrate区块链开发》</a>。</p><h2 id=参考资料>参考资料</h2><ul><li><a href=https://docs.substrate.dev/docs/deploying-a-substrate-node-chain>Start a Private Network with Substrate</a></li></ul></section></article><footer id=post-meta class=clearfix><a href=https://twitter.com/SunWillsuna><img class=avatar src=https://kaichaosun.github.io/images/avatar.png><div><span class=dark>Kaichao Sun</span>
<span>Mark it down</span></div></a><section id=sharing><a class=twitter href="https://twitter.com/intent/tweet?text=https%3a%2f%2fkaichaosun.github.io%2fpost%2fsubstrate_blockchain_setup%2f - %e4%bd%bf%e7%94%a8Substrate%e6%90%ad%e5%bb%ba%e4%bd%a0%e7%9a%84%e7%ac%ac%e4%b8%80%e6%9d%a1%e5%8c%ba%e5%9d%97%e9%93%be by @SunWillsuna"><span class=icon-twitter>tweet</span></a>
<a class=facebook href=# onclick="window.open('https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),'facebook-share-dialog','width=626,height=436');return false;"><span class=icon-facebook-rect>Share</span></a></section></footer><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"whisperd"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a><ul id=post-list class="archive readmore"><h3>Read more</h3><li><a href=/post/kusama_governance/>Kusama系列：如何进行链上治理<aside class=dates>Apr 16 2020</aside></a></li><li><a href=/post/substrate_node_template_guide/>Substrate代码导读：node-template<aside class=dates>Apr 2 2020</aside></a></li><li><a href=/post/trie/>理解Substrate数据存储的底层实现Merkle Patricia Trie<aside class=dates>Mar 17 2020</aside></a></li><li><a href=/post/substrate_transaction_weight_and_fees/>Substrate 区块链应用的交易费用设计<aside class=dates>Feb 21 2020</aside></a></li><li><a href=/post/substrate_storage_data_type/>Substrate存储数据类型概览<aside class=dates>Jan 19 2020</aside></a></li><li><a href=/post/coin_flip_test_and_ui/>抛硬币游戏(二)：编写测试和UI<aside class=dates>Oct 3 2019</aside></a></li><li><a href=/post/substrate_coin_flip/>Substrate应用 - 抛硬币游戏(一)<aside class=dates>Aug 5 2019</aside></a></li><li><a href=/post/why_oo_sucks/>Why OO Sucks<aside class=dates>Apr 25 2019</aside></a></li><li><a href=/post/solidity-basics/>理解Ethereum智能合约开发<aside class=dates>Apr 11 2019</aside></a></li><li><a href=/post/shell-cheatsheet/>Cheatsheet for Shell Programming<aside class=dates>Mar 30 2019</aside></a></li></ul><footer id=footer><div id=social><a class=symbol href=https://github.com/kaichaosun><i class="fa fa-github"></i></a><a class=symbol href=https://twitter.com/kaichaosun><i class="fa fa-twitter"></i></a></div><p class=small>© Copyright 2020 Kaichao Sun</p></footer></section><script src=//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js></script><script src=https://kaichaosun.github.io/js/main.js></script><script src=https://kaichaosun.github.io/js/highlight.js></script><script src=https://kaichaosun.github.io/js/fix-toc.js></script><script>hljs.initHighlightingOnLoad();</script><script data-ad-client=ca-pub-2513693433628672 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-128168145-1','auto');ga('send','pageview');}</script></body></html>