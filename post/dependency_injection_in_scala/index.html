<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Kaichao Sun"><meta name=description content="kaichao's blog"><meta name=generator content="Hugo 0.62.2"><title>Dependency Injection in Scala</title><link rel="shortcut icon" href=https://kaichaosun.github.io/images/favicon.ico><link rel=stylesheet href=https://kaichaosun.github.io/css/style.css><link rel=stylesheet href=https://kaichaosun.github.io/css/highlight.css><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css><meta property="og:title" content="Dependency Injection in Scala"><meta property="og:description" content="What's Dependency Injection Dependency Injection is also known as DI for short. It is all about the way to integrate code between provider and consumer.
Usually, the provider provides functionalities that encapsulated in a function or an object. The consumer, in the opposite it needs to have a provider to do some work.
Then we say that the consumer dependent on the specific provider. There are two options that we can get this provider:"><meta property="og:type" content="article"><meta property="og:url" content="https://kaichaosun.github.io/post/dependency_injection_in_scala/"><meta property="article:published_time" content="2019-01-17T00:00:00+00:00"><meta property="article:modified_time" content="2019-01-17T00:00:00+00:00"><meta itemprop=name content="Dependency Injection in Scala"><meta itemprop=description content="What's Dependency Injection Dependency Injection is also known as DI for short. It is all about the way to integrate code between provider and consumer.
Usually, the provider provides functionalities that encapsulated in a function or an object. The consumer, in the opposite it needs to have a provider to do some work.
Then we say that the consumer dependent on the specific provider. There are two options that we can get this provider:"><meta itemprop=datePublished content="2019-01-17T00:00:00+00:00"><meta itemprop=dateModified content="2019-01-17T00:00:00+00:00"><meta itemprop=wordCount content="452"><meta itemprop=keywords content="FP,Scala,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Dependency Injection in Scala"><meta name=twitter:description content="What's Dependency Injection Dependency Injection is also known as DI for short. It is all about the way to integrate code between provider and consumer.
Usually, the provider provides functionalities that encapsulated in a function or an object. The consumer, in the opposite it needs to have a provider to do some work.
Then we say that the consumer dependent on the specific provider. There are two options that we can get this provider:"><meta name=twitter:site content="@https://twitter.com/kaichaosun"></head><body><nav class=main-nav><a href=https://kaichaosun.github.io/><span class=arrow>‚Üê</span>Home</a>
<a href=/about/>About</a>
<a class=cta href=#email-subscribe>Subscribe</a></nav><section id=wrapper><article class=post><header><h1>Dependency Injection in Scala</h1><h2 class=subtitle></h2><h2 class=headline>January 17, 2019<br><a href=https://kaichaosun.github.io/tags/fp>FP</a>
<a href=https://kaichaosun.github.io/tags/scala>Scala</a></h2></header><aside><nav id=TableOfContents><ul><li><a href=#whats-dependency-injection>What's Dependency Injection</a></li><li><a href=#how-to-do-di-in-scala>How to do DI in Scala</a><ul><li><a href=#cake-pattern>Cake pattern</a></li><li><a href=#reader-monad>Reader monad</a></li><li><a href=#macwire>Macwire</a></li><li><a href=#guice>Guice</a></li><li><a href=#tagless-final>Tagless final</a></li><li><a href=#eff-monad>Eff monad</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></aside><section id=post-body><h2 id=whats-dependency-injection>What's Dependency Injection</h2><p>Dependency Injection is also known as DI for short. It is all about the way to integrate code between provider and consumer.</p><p>Usually, the provider provides functionalities that encapsulated in a function or an object. The consumer, in the opposite it needs to have a provider to do some work.</p><p>Then we say that the consumer dependent on the specific provider. There are two options that we can get this provider:</p><ul><li>construct the provider in consumer.</li><li>inject the provider to consumer when calling the consumer.</li></ul><p>Injection is better since it help us to do split concern (and conform with SRP). As a result, it makes our code easier to understand, more testable and more reusable.</p><p>Different programming language have different way or library to do DI, but the idea behind it is nearly same.</p><h2 id=how-to-do-di-in-scala>How to do DI in Scala</h2><p>Functional programming is all about make function pure, and pure function has two rules:</p><ul><li>Output only depend on input</li><li>No side effect</li></ul><p>That means we prefer to use DI and should never use global state. I have listed a few common ways to do DI in Scala.</p><h3 id=cake-pattern>Cake pattern</h3><p>There is a saying that the cake pattern is dead. You can skip this section without hesitation. If you are still interested in this feature, keep reading from here.</p><p>First let's introduce <em>Self-type</em> identifier <code>self: AnotherTrait =></code> at first line of class or trait definition.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>A</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>def</span> doAStuff <span style=color:#66d9ef>=</span> <span style=color:#e6db74>&#34;in A&#34;</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>B</span> <span style=color:#f92672>{</span>
  self<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span> <span style=color:#f92672>=&gt;</span>
  <span style=color:#66d9ef>def</span> doBStuff <span style=color:#66d9ef>=</span> <span style=color:#e6db74>s&#34;</span><span style=color:#e6db74>in B, </span><span style=color:#e6db74>${</span>doAStuff<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>It means that you can mixed in the trait B only if you mixed in trait A first. <code>self</code> is just an alias for <code>this</code> keyword, using <code>this</code> will cause <a href=https://stackoverflow.com/questions/4017357/difference-between-this-and-self-in-self-type-annotations/4018995#4018995>issue</a> when access the outer scope from inner class.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AppConfig</span><span style=color:#f92672>(</span>host<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>)</span>

<span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>Config</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>def</span> get<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>AppConfig</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Service</span> <span style=color:#f92672>{</span>
  self<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Config</span> <span style=color:#f92672>=&gt;</span>
  <span style=color:#66d9ef>def</span> run <span style=color:#66d9ef>=</span> println<span style=color:#f92672>(</span><span style=color:#e6db74>s&#34;</span><span style=color:#e6db74>config: </span><span style=color:#e6db74>$get</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>val</span> service <span style=color:#66d9ef>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Service</span> <span style=color:#66d9ef>with</span> <span style=color:#a6e22e>Config</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>def</span> get<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>AppConfig</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>AppConfig</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;http://example.com&#34;</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>

service<span style=color:#f92672>.</span>run  <span style=color:#75715e>// config: AppConfig(http://example.com)
</span></code></pre></div><p>In above code, we need to give implementation for each injected trait when instantiate the <code>Service</code> class or trait. Here is a more practical way to do it.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>ConfigComponent</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>val</span> config<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Config</span>
  
  <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Config</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>def</span> get<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>AppConfig</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>AppConfig</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;http://example.com&#34;</span><span style=color:#f92672>)</span>
  <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Service</span> <span style=color:#f92672>{</span>
  self<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>ConfigComponent</span> <span style=color:#f92672>=&gt;</span>
  <span style=color:#66d9ef>def</span> run <span style=color:#66d9ef>=</span> println<span style=color:#f92672>(</span><span style=color:#e6db74>s&#34;</span><span style=color:#e6db74>config: </span><span style=color:#e6db74>${</span>config<span style=color:#f92672>.</span>get<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>val</span> service <span style=color:#66d9ef>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Service</span> <span style=color:#66d9ef>with</span> <span style=color:#a6e22e>ConfigComponent</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>val</span> config <span style=color:#66d9ef>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Config</span>
<span style=color:#f92672>}</span>

service<span style=color:#f92672>.</span>run  <span style=color:#75715e>// config: AppConfig(http://example.com)
</span></code></pre></div><p>If there is multiple dependencies, you can simply use <code>with</code> between the traits.</p><h3 id=reader-monad>Reader monad</h3><h3 id=macwire>Macwire</h3><h3 id=guice>Guice</h3><h3 id=tagless-final>Tagless final</h3><h3 id=eff-monad>Eff monad</h3><h2 id=references>References</h2><ul><li><a href=https://github.com/adamw/macwire>macwire</a></li><li><a href=http://di-in-scala.github.io/>DI in Scala guide</a></li><li><a href=https://mikulskibartosz.name/the-cake-pattern-is-a-lie-2fe1cfd7dea9>The cake pattern is a lie</a></li><li><a href=https://docs.scala-lang.org/tour/self-types.html>Scala: Self-type</a></li><li><a href=http://enear.github.io/2018/10/08/self-arrow/>Disambiguating &lsquo;this&rsquo; in Scala</a></li></ul></section></article><footer id=post-meta class=clearfix><a href=https://twitter.com/kaichaosun><img class=avatar src=https://kaichaosun.github.io/images/avatar.png><div><span class=dark>Kaichao Sun</span>
<span>Mark it down</span></div></a><section id=sharing><a class=twitter href="https://twitter.com/intent/tweet?text=https%3a%2f%2fkaichaosun.github.io%2fpost%2fdependency_injection_in_scala%2f - Dependency%20Injection%20in%20Scala by @kaichaosun"><span class=icon-twitter>tweet</span></a>
<a class=facebook href=# onclick="window.open('https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),'facebook-share-dialog','width=626,height=436');return false;"><span class=icon-facebook-rect>Share</span></a></section></footer><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"whisperd"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a><ul id=post-list class="archive readmore"><iframe src=https://kaichao.substack.com/embed id=email-subscribe width=100% height=320 style="border:1px solid #eee;background:#fff;margin-top:60px" frameborder=0 scrolling=no></iframe><h3>Read more</h3><li><a href=https://kaichaosun.github.io/post/how_did_we_do_wrong/>ÂÖ≥‰∫éÊñ∞ÂÜ†ÔºåÊàë‰ª¨ÂÅöÈîô‰∫Ü‰ªÄ‰πàÔºü<aside class=dates>Apr 14 2022</aside></a></li><li><a href=https://kaichaosun.github.io/post/understand_decentralization/>Â¶Ç‰ΩïÁêÜËß£Âéª‰∏≠ÂøÉ<aside class=dates>Feb 23 2022</aside></a></li><li><a href=https://kaichaosun.github.io/post/build_team/>Build in PublicÔºöÂàõ‰∏öÂõ¢ÈòüÁöÑÈáçË¶ÅÊÄß<aside class=dates>Feb 11 2022</aside></a></li><li><a href=https://kaichaosun.github.io/post/substrate_history/>Substrate ÊäÄÊúØÊºîËøõ<aside class=dates>Jan 22 2022</aside></a></li><li><a href=https://kaichaosun.github.io/post/metaverse/>ÂÖÉÂÆáÂÆô‰ºö‰∏ç‰ºöÊääÊàë‰ª¨‰ªé‰∏ÄÊù°‰∫∫ÂèòÊàê‰∏ÄÊù°ÁãóÔºü<aside class=dates>Jan 21 2022</aside></a></li><li><a href=https://kaichaosun.github.io/post/substrate_network_libp2p/>Substrate Â¶Ç‰Ωï‰ΩøÁî® libp2p ËøõË°åÁÇπÂØπÁÇπÈÄö‰ø°<aside class=dates>Feb 8 2021</aside></a></li><li><a href=https://kaichaosun.github.io/post/substrate_read_source_code/>ÈòÖËØªSubstrateÊ∫êÁ†ÅÁöÑÊñπÊ≥ï<aside class=dates>Jan 6 2021</aside></a></li><li><a href=https://kaichaosun.github.io/post/learn_substrate/>Â¶Ç‰ΩïÂ≠¶‰π†Substrate<aside class=dates>Jul 20 2020</aside></a></li><li><a href=https://kaichaosun.github.io/post/substrate_launch_public_testnet/>Substrate ÈÉ®ÁΩ≤ÂÖ¨ÂºÄÊµãËØïÁΩëÁªú<aside class=dates>Jul 17 2020</aside></a></li><li><a href=https://kaichaosun.github.io/post/how_to_blockchain/>Â¶Ç‰ΩïÂ≠¶‰π†Âå∫ÂùóÈìæÊäÄÊúØ<aside class=dates>Apr 30 2020</aside></a></li><li><a href=https://kaichaosun.github.io/post/kusama_governance/>KusamaÁ≥ªÂàóÔºöÂ¶Ç‰ΩïËøõË°åÈìæ‰∏äÊ≤ªÁêÜ<aside class=dates>Apr 16 2020</aside></a></li><li><a href=https://kaichaosun.github.io/post/substrate_node_template_guide/>Substrate‰ª£Á†ÅÂØºËØªÔºönode-template<aside class=dates>Apr 2 2020</aside></a></li><li><a href=https://kaichaosun.github.io/post/trie/>ÁêÜËß£SubstrateÊï∞ÊçÆÂ≠òÂÇ®ÁöÑÂ∫ïÂ±ÇÂÆûÁé∞Merkle Patricia Trie<aside class=dates>Mar 17 2020</aside></a></li><li><a href=https://kaichaosun.github.io/post/substrate_transaction_weight_and_fees/>Substrate Âå∫ÂùóÈìæÂ∫îÁî®ÁöÑ‰∫§ÊòìË¥πÁî®ËÆæËÆ°<aside class=dates>Feb 21 2020</aside></a></li><li><a href=https://kaichaosun.github.io/post/substrate_storage_data_type/>SubstrateÂ≠òÂÇ®Êï∞ÊçÆÁ±ªÂûãÊ¶ÇËßà<aside class=dates>Jan 19 2020</aside></a></li><li><a href=https://kaichaosun.github.io/post/coin_flip_test_and_ui/>ÊäõÁ°¨Â∏ÅÊ∏∏Êàè(‰∫å)ÔºöÁºñÂÜôÊµãËØïÂíåUI<aside class=dates>Oct 3 2019</aside></a></li><li><a href=https://kaichaosun.github.io/post/substrate_metadata/>Substrate Runtime Metadata<aside class=dates>Sep 7 2019</aside></a></li><li><a href=https://kaichaosun.github.io/post/substrate_coin_flip/>SubstrateÂ∫îÁî® - ÊäõÁ°¨Â∏ÅÊ∏∏Êàè(‰∏Ä)<aside class=dates>Aug 5 2019</aside></a></li><li><a href=https://kaichaosun.github.io/post/substrate_module_struct/>Substrate Module Struct<aside class=dates>Jul 30 2019</aside></a></li><li><a href=https://kaichaosun.github.io/post/substrate_blockchain_setup/>‰ΩøÁî®SubstrateÊê≠Âª∫‰Ω†ÁöÑÁ¨¨‰∏ÄÊù°Âå∫ÂùóÈìæ<aside class=dates>May 28 2019</aside></a></li></ul><footer id=footer><div id=social><a class=symbol href=https://github.com/kaichaosun><i class="fa fa-github"></i></a><a class=symbol href=https://t.me/kaichaosun><i class="fa fa-telegram"></i></a><a class=symbol href=https://twitter.com/kaichaosun><i class="fa fa-twitter"></i></a></div><p class=small>¬© Copyright 2023 Kaichao Sun</p></footer></section><script src=//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js></script><script src=https://kaichaosun.github.io/js/main.js></script><script src=https://kaichaosun.github.io/js/highlight.js></script><script src=https://kaichaosun.github.io/js/fix-toc.js></script><script>hljs.initHighlightingOnLoad();</script><script data-ad-client=ca-pub-2513693433628672 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-128168145-1','auto');ga('send','pageview');}</script></body></html>